<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-adsense-account" content="ca-pub-3179065211650247">

    <title>{% block title %}{% endblock %} - Spranki | Interactive Music Experience</title>
    
    <!-- Clarity Analytics -->
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "qtk3rc7n6l");
    </script>

    <!-- SEO Meta Tags -->
    {% block meta_description %}{% endblock %}
    <meta name="author" content="Spranki">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="{% block og_title %}Spranki - Interactive Music Experience{% endblock %}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://spranki.art{{ request.path }}">
    <meta property="og:image" content="{% block og_image %}{{ url_for('static', filename='images/og-image.jpg', _external=True) }}{% endblock %}">
    <meta property="og:site_name" content="Spranki">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ self.og_title() }}">
    <meta name="twitter:image" content="{{ self.og_image() }}">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://spranki.art{{ request.path }}">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/favicon.png') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='img/favicon.png') }}">
    
    </script>
    
    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.13.3/dist/cdn.min.js"></script>
    
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    
    <!-- Core Styles -->
    <style>
        :root { --primary-color: #3b82f6; }
        .dark { --primary-color: #60a5fa; }
        body { font-family: 'Inter', system-ui, sans-serif; }
        .animate-blob { animation: blob 7s infinite; }
        @keyframes blob {
            0% { transform: translate(0px, 0px) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0px, 0px) scale(1); }
        }
        .animation-delay-2000 { animation-delay: 2s; }
        .animate-on-scroll { opacity: 0; transform: translateY(20px); transition: all 0.6s ease-out; }
        .animate-on-scroll.animate { opacity: 1; transform: translateY(0); }
        nav { transition: transform 0.3s ease-in-out; }
        nav.scroll-down { transform: translateY(-100%); }
        nav.scroll-up { transform: translateY(0); }
        
        /* 自定义宽高比容器 */
        .aspect-4-3 {
            position: relative;
            width: 100%;
            padding-bottom: 75%; /* 4:3 = 75% */
            height: 0;
            overflow: hidden;
        }
        .aspect-4-3 > .content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
    </style>
    {% block styles %}{% endblock %}
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZX3363GEYL"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-ZX3363GEYL');
    </script>
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3179065211650247" crossorigin="anonymous"></script>
    
    <!-- Schema.org Markup -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "Spranki",
        "description": "An interactive music creation platform where you can create beats, mix sounds, and make your own music.",
        "url": "https://spranki.art",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://spranki.art/search?q={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
    
    <!-- Game Loading Script -->
    <script>
        function loadGame(buttonElement, gameUrl) {
            // 找到游戏容器和内容容器
            const container = buttonElement.closest('.game-container');
            const contentDiv = buttonElement.closest('.content');
            
            // 创建iframe
            const iframe = document.createElement('iframe');
            iframe.src = gameUrl;
            iframe.className = 'w-full h-full border-0';
            iframe.scrolling = 'no';
            iframe.allowFullscreen = true;
            
            // 清空内容容器并添加iframe
            contentDiv.innerHTML = '';
            contentDiv.appendChild(iframe);
        }
    </script>
</head>

<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen flex flex-col" x-data="{ theme: 'light', mobileMenu: false }">
    <!-- Navigation -->
    {% include 'components/nav.html' %}

    <main class="pt-16 sm:pt-20 flex-grow">
        <!-- Affiliate Banner -->
        {% include 'components/affiliate_banner.html' %}
                {% block content %}{% endblock %}
    </main>

    <!-- 广告区域 - 使用iframe沙盒保护 -->
    <section class="ad-container py-4 bg-gray-100 dark:bg-gray-800">
        <div class="container mx-auto px-4">
            <div class="max-w-4xl mx-auto">
                <!-- 广告标题 -->
                <div class="text-center mb-2">
                    <span class="text-xs text-gray-500 dark:text-gray-400">Advertisement</span>
                </div>
                <!-- 广告iframe容器 -->
                <div class="ad-iframe-wrapper bg-white dark:bg-gray-700 rounded-lg shadow-sm border border-gray-200 dark:border-gray-600">
                    <iframe 
                        id="ad-iframe"
                        class="w-full h-64 border-0 rounded-lg"
                        sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox"
                        loading="lazy"
                        title="Advertisement">
                    </iframe>
                </div>
            </div>
        </div>
    </section>

    {% include 'components/footer.html' %}

    <!-- 广告脚本 - 在iframe中加载 -->
    <script>
        // 创建广告内容
        function loadAdContent() {
            const iframe = document.getElementById('ad-iframe');
            const adContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <style>
                        body { 
                            margin: 0; 
                            padding: 0; 
                            font-family: Arial, sans-serif; 
                            background: transparent;
                            overflow: hidden;
                        }
                        .ad-content {
                            width: 100%;
                            height: 100%;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                        }
                    </style>
                </head>
                <body>
                    <div class="ad-content">
                        <!-- 广告容器 -->
                        <div id="container-3cc67bb706b413acf0b69af358da16e5"></div>
                    </div>
                    
                    <!-- 广告脚本 -->
                    <script type='text/javascript' src='//pl27660422.revenuecpmgate.com/b8/47/52/b84752c4158bc729c382a28cab5d0343.js'><\/script>
                    <script async="async" data-cfasync="false" src="//pl27660410.revenuecpmgate.com/3cc67bb706b413acf0b69af358da16e5/invoke.js"><\/script>
                </body>
                </html>
            `;
            
            // 将内容写入iframe
            iframe.contentDocument.open();
            iframe.contentDocument.write(adContent);
            iframe.contentDocument.close();
        }
        
        // 页面加载完成后初始化广告
        document.addEventListener('DOMContentLoaded', function() {
            // 延迟加载广告，避免影响页面性能
            setTimeout(loadAdContent, 1000);
        });
    </script>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/main.min.js') }}" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide@latest"></script>
    <script>lucide.createIcons();</script>
    {% block scripts %}{% endblock %}
</body>
</html>
